!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}(function(l){"use strict";var n=0;l.ajaxTransport("iframe",function(r){if(r.async){var o,a,t,s=r.initialIframeSrc||"javascript:false;";return{send:function(e,i){(o=l('<form style="display:none;"></form>')).attr("accept-charset",r.formAcceptCharset),t=/\?/.test(r.url)?"&":"?","DELETE"===r.type?(r.url=r.url+t+"_method=DELETE",r.type="POST"):"PUT"===r.type?(r.url=r.url+t+"_method=PUT",r.type="POST"):"PATCH"===r.type&&(r.url=r.url+t+"_method=PATCH",r.type="POST"),a=l('<iframe src="'+s+'" name="iframe-transport-'+(n+=1)+'"></iframe>').bind("load",function(){var n,t=l.isArray(r.paramName)?r.paramName:[r.paramName];a.unbind("load").bind("load",function(){var t;try{if(!(t=a.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}i(200,"success",{iframe:t}),l('<iframe src="'+s+'"></iframe>').appendTo(o),window.setTimeout(function(){o.remove()},0)}),o.prop("target",a.prop("name")).prop("action",r.url).prop("method",r.type),r.formData&&l.each(r.formData,function(e,t){l('<input type="hidden"/>').prop("name",t.name).val(t.value).appendTo(o)}),r.fileInput&&r.fileInput.length&&"POST"===r.type&&(n=r.fileInput.clone(),r.fileInput.after(function(e){return n[e]}),r.paramName&&r.fileInput.each(function(e){l(this).prop("name",t[e]||r.paramName)}),o.append(r.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),r.fileInput.removeAttr("form")),o.submit(),n&&n.length&&r.fileInput.each(function(e,t){var i=l(n[e]);l(t).prop("name",i.prop("name")).attr("form",i.attr("form")),i.replaceWith(t)})}),o.append(a).appendTo(document.body)},abort:function(){a&&a.unbind("load").prop("src",s),o&&o.remove()}}}}),l.ajaxSetup({converters:{"iframe text":function(e){return e&&l(e[0].body).text()},"iframe json":function(e){return e&&l.parseJSON(l(e[0].body).text())},"iframe html":function(e){return e&&l(e[0].body).html()},"iframe xml":function(e){var t=e&&e[0];return t&&l.isXMLDoc(t)?t:l.parseXML(t.XMLDocument&&t.XMLDocument.xml||l(t.body).html())},"iframe script":function(e){return e&&l.globalEval(l(e[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(_){"use strict";function e(i){var n="dragover"===i;return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=e.dataTransfer;t&&-1!==_.inArray("Files",t.types)&&!1!==this._trigger(i,_.Event(i,{delegatedEvent:e}))&&(e.preventDefault(),n&&(t.dropEffect="copy"))}}_.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||_('<input type="file">').prop("disabled")),_.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),_.support.xhrFormDataFileUpload=!!window.FormData,_.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),_.widget("blueimp.fileupload",{options:{dropZone:_(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(i,e){return i=this.messages[i]||i.toString(),e&&_.each(e,function(e,t){i=i.replace("{"+e+"}",t)}),i},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&_(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:_.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||i<n)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&_.support.xhrFileUpload||_.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"===_.type(e.formData)?e.formData(e.form):_.isArray(e.formData)?e.formData:"object"===_.type(e.formData)?(i=[],_.each(e.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(e){var i=0;return _.each(e,function(e,t){i+=t.size||1}),i},_initProgressObject:function(e){var t={loaded:0,total:0,bitrate:0};e._progress?_.extend(e._progress,t):e._progress=t},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var i,n=Date.now?Date.now():(new Date).getTime();if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(n,i,t.bitrateInterval),this._trigger("progress",_.Event("progress",{delegatedEvent:e}),t),this._trigger("progressall",_.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(i){var n=this,e=i.xhr?i.xhr():_.ajaxSettings.xhr();e.upload&&(_(e.upload).bind("progress",function(e){var t=e.originalEvent;e.lengthComputable=t.lengthComputable,e.loaded=t.loaded,e.total=t.total,n._onProgress(e,i)}),i.xhr=function(){return e})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(i){var n,r=this,e=i.files[0],t=i.multipart||!_.support.xhrFileUpload,o="array"===_.type(i.paramName)?i.paramName[0]:i.paramName;i.headers=_.extend({},i.headers),i.contentRange&&(i.headers["Content-Range"]=i.contentRange),t&&!i.blob&&this._isInstanceOf("File",e)||(i.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"'),t?_.support.xhrFormDataFileUpload&&(i.postMessage?(n=this._getFormData(i),i.blob?n.push({name:o,value:i.blob}):_.each(i.files,function(e,t){n.push({name:"array"===_.type(i.paramName)&&i.paramName[e]||o,value:t})})):(r._isInstanceOf("FormData",i.formData)?n=i.formData:(n=new FormData,_.each(this._getFormData(i),function(e,t){n.append(t.name,t.value)})),i.blob?n.append(o,i.blob,e.name):_.each(i.files,function(e,t){(r._isInstanceOf("File",t)||r._isInstanceOf("Blob",t))&&n.append("array"===_.type(i.paramName)&&i.paramName[e]||o,t,t.uploadName||t.name)})),i.data=n):(i.contentType=e.type||"application/octet-stream",i.data=i.blob||e),i.blob=null},_initIframeSettings:function(e){var t=_("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t&&t!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(e){var t=_(e.fileInput),n=e.paramName;return n?_.isArray(n)||(n=[n]):(n=[],t.each(function(){for(var e=_(this),t=e.prop("name")||"files[]",i=(e.prop("files")||[1]).length;i;)n.push(t),i-=1}),n.length||(n=[t.prop("name")||"files[]"])),n},_initFormSettings:function(e){e.form&&e.form.length||(e.form=_(e.fileInput.prop("form")),e.form.length||(e.form=_(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===_.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=_.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,i){var n=_.Deferred(),r=n.promise();return t=t||this.options.context||r,!0===e?n.resolveWith(t,i):!1===e&&n.rejectWith(t,i),r.abort=n.promise,this._enhancePromise(r)},_addConvenienceMethods:function(e,i){var n=this,r=function(e){return _.Deferred().resolveWith(n,e).promise()};i.process=function(e,t){return(e||t)&&(i._processQueue=this._processQueue=(this._processQueue||r([this])).pipe(function(){return i.errorThrown?_.Deferred().rejectWith(n,[i]).promise():r(arguments)}).pipe(e,t)),this._processQueue||r([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=!1!==n._trigger("submit",_.Event("submit",{delegatedEvent:e}),this)&&n._onSend(e,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&1<i.length&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(o,e){o.uploadedBytes=o.uploadedBytes||0;var t,a,s=this,i=o.files[0],l=i.size,d=o.uploadedBytes,p=o.maxChunkSize||l,u=this._blobSlice,f=_.Deferred(),n=f.promise();return!(!(this._isXHRUpload(o)&&u&&(d||p<l))||o.data)&&(!!e||(l<=d?(i.error=o.i18n("uploadedBytes"),this._getXHRPromise(!1,o.context,[null,"error",i.error])):(a=function(){var n=_.extend({},o),r=n._progress.loaded;n.blob=u.call(i,d,d+p,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+d+"-"+(d+n.chunkSize-1)+"/"+l,s._initXHRData(n),s._initProgressListener(n),t=(!1!==s._trigger("chunksend",null,n)&&_.ajax(n)||s._getXHRPromise(!1,n.context)).done(function(e,t,i){d=s._getUploadedBytes(i)||d+n.chunkSize,r+n.chunkSize-n._progress.loaded&&s._onProgress(_.Event("progress",{lengthComputable:!0,loaded:d-n.uploadedBytes,total:d-n.uploadedBytes}),n),o.uploadedBytes=n.uploadedBytes=d,n.result=e,n.textStatus=t,n.jqXHR=i,s._trigger("chunkdone",null,n),s._trigger("chunkalways",null,n),d<l?a():f.resolveWith(n.context,[e,t,i])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,s._trigger("chunkfail",null,n),s._trigger("chunkalways",null,n),f.rejectWith(n.context,[e,t,i])})},this._enhancePromise(n),n.abort=function(){return t.abort()},a(),n)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,t,i,n){var r=n._progress.total,o=n._response;n._progress.loaded<r&&this._onProgress(_.Event("progress",{lengthComputable:!0,loaded:r,total:r}),n),o.result=n.result=e,o.textStatus=n.textStatus=t,o.jqXHR=n.jqXHR=i,this._trigger("done",null,n)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);var i,n,r,o,a=this,s=a._getAJAXSettings(t),l=function(){return a._sending+=1,s._bitrateTimer=new a._BitrateTimer,i=i||((n||!1===a._trigger("send",_.Event("send",{delegatedEvent:e}),s))&&a._getXHRPromise(!1,s.context,n)||a._chunkedUpload(s)||_.ajax(s)).done(function(e,t,i){a._onDone(e,t,i,s)}).fail(function(e,t,i){a._onFail(e,t,i,s)}).always(function(e,t,i){if(a._onAlways(e,t,i,s),a._sending-=1,a._active-=1,s.limitConcurrentUploads&&s.limitConcurrentUploads>a._sending)for(var n=a._slots.shift();n;){if("pending"===a._getDeferredState(n)){n.resolve();break}n=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(e,s),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?((o=1<this.options.limitConcurrentUploads?(r=_.Deferred(),this._slots.push(r),r.pipe(l)):(this._sequence=this._sequence.pipe(l,l),this._sequence)).abort=function(){return n=[void 0,"abort","abort"],i?i.abort():(r&&r.rejectWith(s.context,n),l())},this._enhancePromise(o)):l()},_onAdd:function(n,r){var o,e,a,t,s=this,l=!0,i=_.extend({},this.options,r),d=r.files,p=d.length,u=i.limitMultiFileUploads,f=i.limitMultiFileUploadSize,c=i.limitMultiFileUploadSizeOverhead,h=0,m=this._getParamName(i),g=0;if(!f||p&&void 0!==d[0].size||(f=void 0),(i.singleFileUploads||u||f)&&this._isXHRUpload(i))if(i.singleFileUploads||f||!u)if(!i.singleFileUploads&&f)for(a=[],o=[],t=0;t<p;t+=1)h+=d[t].size+c,(t+1===p||h+d[t+1].size+c>f||u&&u<=t+1-g)&&(a.push(d.slice(g,t+1)),(e=m.slice(g,t+1)).length||(e=m),o.push(e),g=t+1,h=0);else o=m;else for(a=[],o=[],t=0;t<p;t+=u)a.push(d.slice(t,t+u)),(e=m.slice(t,t+u)).length||(e=m),o.push(e);else a=[d],o=[m];return r.originalFiles=d,_.each(a||d,function(e,t){var i=_.extend({},r);return i.files=a?t:[t],i.paramName=o[e],s._initResponseObject(i),s._initProgressObject(i),s._addConvenienceMethods(n,i),l=s._trigger("add",_.Event("add",{delegatedEvent:n}),i)}),l},_replaceFileInput:function(e){var i=e.fileInput,n=i.clone(!0);e.fileInputClone=n,_("<form></form>").append(n)[0].reset(),i.after(n).detach(),_.cleanData(i.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===i[0]?n[0]:t}),i[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(i,n){var e,r=this,o=_.Deferred(),a=function(e){e&&!e.entry&&(e.entry=i),o.resolve([e])},s=function(){e.readEntries(function(e){var t;e.length?(l=l.concat(e),s()):(t=l,r._handleFileTreeEntries(t,n+i.name+"/").done(function(e){o.resolve(e)}).fail(a))},a)},l=[];return n=n||"",i.isFile?i._file?(i._file.relativePath=n,o.resolve(i._file)):i.file(function(e){e.relativePath=n,o.resolve(e)},a):i.isDirectory?(e=i.createReader(),s()):o.resolve([]),o.promise()},_handleFileTreeEntries:function(e,t){var i=this;return _.when.apply(_,_.map(e,function(e){return i._handleFileTreeEntry(e,t)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){var t=(e=e||{}).items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries(_.map(t,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):_.Deferred().resolve(_.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){var t,i,n=(e=_(e)).prop("webkitEntries")||e.prop("entries");if(n&&n.length)return this._handleFileTreeEntries(n);if((t=_.makeArray(e.prop("files"))).length)void 0===t[0].name&&t[0].fileName&&_.each(t,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(i=e.prop("value")))return _.Deferred().resolve([]).promise();t=[{name:i.replace(/^.*\\/,"")}]}return _.Deferred().resolve(t).promise()},_getFileInputFiles:function(e){return e instanceof _&&1!==e.length?_.when.apply(_,_.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(t){var i=this,n={fileInput:_(t.target),form:_(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(e){n.files=e,i.options.replaceFileInput&&i._replaceFileInput(n),!1!==i._trigger("change",_.Event("change",{delegatedEvent:t}),n)&&i._onAdd(t,n)})},_onPaste:function(e){var t=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,n={files:[]};t&&t.length&&(_.each(t,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),!1!==this._trigger("paste",_.Event("paste",{delegatedEvent:e}),n)&&this._onAdd(e,n))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,e=t.dataTransfer,n={};e&&e.files&&e.files.length&&(t.preventDefault(),this._getDroppedFiles(e).always(function(e){n.files=e,!1!==i._trigger("drop",_.Event("drop",{delegatedEvent:t}),n)&&i._onAdd(t,n)}))},_onDragOver:e("dragover"),_onDragEnter:e("dragenter"),_onDragLeave:e("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),_.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,t){var i=-1!==_.inArray(e,this._specialOptions);i&&this._destroyEventHandlers(),this._super(e,t),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof _||(e.fileInput=_(e.fileInput)),e.dropZone instanceof _||(e.dropZone=_(e.dropZone)),e.pasteZone instanceof _||(e.pasteZone=_(e.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(e,t){return"url"!==e&&"string"===_.type(t)&&/^\/.*\/[igm]{0,3}$/.test(t)},_initDataAttributes:function(){var r=this,o=this.options,a=this.element.data();_.each(this.element[0].attributes,function(e,t){var i,n=t.name.toLowerCase();/^data-/.test(n)&&(n=n.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),i=a[n],r._isRegExpOption(n,i)&&(i=r._getRegExp(i)),o[n]=i)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=_.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,r=this,o=_.Deferred(),e=o.promise();return e.abort=function(){return n=!0,i?i.abort():(o.reject(null,"abort","abort"),e)},this._getFileInputFiles(t.fileInput).always(function(e){n||(e.length?(t.files=e,(i=r._onSend(null,t)).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)})):o.reject())}),this._enhancePromise(e)}if(t.files=_.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}(function(a){"use strict";var n=a.blueimp.fileupload.prototype.options.add;a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{processQueue:[],add:function(e,t){var i=a(this);t.process(function(){return i.fileupload("process",t)}),n.call(this,e,t)}},processActions:{},_processFile:function(e,n){var r=this,o=a.Deferred().resolveWith(r,[e]).promise();return this._trigger("process",null,e),a.each(e.processQueue,function(e,t){var i=function(e){return n.errorThrown?a.Deferred().rejectWith(r,[n]).promise():r.processActions[t.action].call(r,e,t)};o=o.pipe(i,t.always&&i)}),o.done(function(){r._trigger("processdone",null,e),r._trigger("processalways",null,e)}).fail(function(){r._trigger("processfail",null,e),r._trigger("processalways",null,e)}),o},_transformProcessQueue:function(r){var t=[];a.each(r.processQueue,function(){var i={},e=this.action,n=!0===this.prefix?e:this.prefix;a.each(this,function(e,t){"string"===a.type(t)&&"@"===t.charAt(0)?i[e]=r[t.slice(1)||(n?n+e.charAt(0).toUpperCase()+e.slice(1):e)]:i[e]=t}),t.push(i)}),r.processQueue=t},processing:function(){return this._processing},process:function(n){var r=this,o=a.extend({},this.options,n);return o.processQueue&&o.processQueue.length&&(this._transformProcessQueue(o),0===this._processing&&this._trigger("processstart"),a.each(n.files,function(e){var t=e?a.extend({},o):o,i=function(){return n.errorThrown?a.Deferred().rejectWith(r,[n]).promise():r._processFile(t,n)};t.index=e,r._processing+=1,r._processingQueue=r._processingQueue.pipe(i,i).always(function(){r._processing-=1,0===r._processing&&r._trigger("processstop")})})),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=a.Deferred().resolveWith(this).promise()}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("load-image")):e(window.jQuery,window.loadImage)}(function(s,l){"use strict";s.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"}),s.widget("blueimp.fileupload",s.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(t,e){if(e.disabled)return t;var i=this,n=t.files[t.index],r=s.Deferred();return"number"===s.type(e.maxFileSize)&&n.size>e.maxFileSize||e.fileTypes&&!e.fileTypes.test(n.type)||!l(n,function(e){e.src&&(t.img=e),r.resolveWith(i,[t])},e)?t:r.promise()},resizeImage:function(t,i){if(i.disabled||!t.canvas&&!t.img)return t;i=s.extend({canvas:!0},i);var e,n=this,r=s.Deferred(),o=i.canvas&&t.canvas||t.img,a=function(e){e&&(e.width!==o.width||e.height!==o.height||i.forceResize)&&(t[e.getContext?"canvas":"img"]=e),t.preview=e,r.resolveWith(n,[t])};if(t.exif){if(!0===i.orientation&&(i.orientation=t.exif.get("Orientation")),i.thumbnail&&(e=t.exif.get("Thumbnail")))return l(e,a,i),r.promise();t.orientation?delete i.orientation:t.orientation=i.orientation}return o?(a(l.scale(o,i)),r.promise()):t},saveImage:function(t,e){if(!t.canvas||e.disabled)return t;var i=this,n=t.files[t.index],r=s.Deferred();return t.canvas.toBlob?(t.canvas.toBlob(function(e){e.name||(n.type===e.type?e.name=n.name:n.name&&(e.name=n.name.replace(/\.\w+$/,"."+e.type.substr(6)))),n.type!==e.type&&delete t.imageHead,t.files[t.index]=e,r.resolveWith(i,[t])},e.type||n.type,e.quality),r.promise()):t},loadImageMetaData:function(t,e){if(e.disabled)return t;var i=this,n=s.Deferred();return l.parseMetaData(t.files[t.index],function(e){s.extend(t,e),n.resolveWith(i,[t])},e),n.promise()},saveImageMetaData:function(e,t){if(!(e.imageHead&&e.canvas&&e.canvas.toBlob)||t.disabled)return e;var i=e.files[e.index],n=new Blob([e.imageHead,this._blobSlice.call(i,20)],{type:i.type});return n.name=i.name,e.files[e.index]=n,e},setImage:function(e,t){return e.preview&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.preview),e},deleteImageReferences:function(e,t){return t.disabled||(delete e.img,delete e.canvas,delete e.preview,delete e.imageHead),e}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("load-image")):e(window.jQuery,window.loadImage)}(function(o,a){"use strict";o.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadAudio",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableAudioPreview"},{action:"setAudio",name:"@audioPreviewName",disabled:"@disableAudioPreview"}),o.widget("blueimp.fileupload",o.blueimp.fileupload,{options:{loadAudioFileTypes:/^audio\/.*$/},_audioElement:document.createElement("audio"),processActions:{loadAudio:function(e,t){if(t.disabled)return e;var i,n,r=e.files[e.index];return this._audioElement.canPlayType&&this._audioElement.canPlayType(r.type)&&("number"!==o.type(t.maxFileSize)||r.size<=t.maxFileSize)&&(!t.fileTypes||t.fileTypes.test(r.type))&&(i=a.createObjectURL(r))&&((n=this._audioElement.cloneNode(!1)).src=i,n.controls=!0,e.audio=n),e},setAudio:function(e,t){return e.audio&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.audio),e}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("load-image")):e(window.jQuery,window.loadImage)}(function(o,a){"use strict";o.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadVideo",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableVideoPreview"},{action:"setVideo",name:"@videoPreviewName",disabled:"@disableVideoPreview"}),o.widget("blueimp.fileupload",o.blueimp.fileupload,{options:{loadVideoFileTypes:/^video\/.*$/},_videoElement:document.createElement("video"),processActions:{loadVideo:function(e,t){if(t.disabled)return e;var i,n,r=e.files[e.index];return this._videoElement.canPlayType&&this._videoElement.canPlayType(r.type)&&("number"!==o.type(t.maxFileSize)||r.size<=t.maxFileSize)&&(!t.fileTypes||t.fileTypes.test(r.type))&&(i=a.createObjectURL(r))&&((n=this._videoElement.cloneNode(!1)).src=i,n.controls=!0,e.video=n),e},setVideo:function(e,t){return e.video&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.video),e}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}(function(a){"use strict";a.blueimp.fileupload.prototype.options.processQueue.push({action:"validate",always:!0,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"}),a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{getNumberOfFiles:a.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(e,t){if(t.disabled)return e;var i,n=a.Deferred(),r=this.options,o=e.files[e.index];return(t.minFileSize||t.maxFileSize)&&(i=o.size),"number"===a.type(t.maxNumberOfFiles)&&(r.getNumberOfFiles()||0)+e.files.length>t.maxNumberOfFiles?o.error=r.i18n("maxNumberOfFiles"):!t.acceptFileTypes||t.acceptFileTypes.test(o.type)||t.acceptFileTypes.test(o.name)?i>t.maxFileSize?o.error=r.i18n("maxFileSize"):"number"===a.type(i)&&i<t.minFileSize?o.error=r.i18n("minFileSize"):delete o.error:o.error=r.i18n("acceptFileTypes"),o.error||e.files.error?(e.files.error=!0,n.rejectWith(this,[e])):n.resolveWith(this,[e]),n.promise()}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):"object"==typeof exports?e(require("jquery"),require("tmpl")):e(window.jQuery,window.tmpl)}(function(l,t){"use strict";l.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),l.widget("blueimp.fileupload",l.blueimp.fileupload,{options:{autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",messages:{unknownError:"Unknown error"},getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(e){return e.result&&l.isArray(e.result.files)?e.result.files:[]},add:function(e,i){if(e.isDefaultPrevented())return!1;var t=l(this),n=t.data("blueimp-fileupload")||t.data("fileupload"),r=n.options;i.context=n._renderUpload(i.files).data("data",i).addClass("processing"),r.filesContainer[r.prependFiles?"prepend":"append"](i.context),n._forceReflow(i.context),n._transition(i.context),i.process(function(){return t.fileupload("process",i)}).always(function(){i.context.each(function(e){l(this).find(".size").text(n._formatFileSize(i.files[e].size))}).removeClass("processing"),n._renderPreviews(i)}).done(function(){i.context.find(".start").prop("disabled",!1),!1!==n._trigger("added",e,i)&&(r.autoUpload||i.autoUpload)&&!1!==i.autoUpload&&i.submit()}).fail(function(){i.files.error&&i.context.each(function(e){var t=i.files[e].error;t&&l(this).find(".error").text(t)})})},send:function(e,t){if(e.isDefaultPrevented())return!1;var i=l(this).data("blueimp-fileupload")||l(this).data("fileupload");return t.context&&t.dataType&&"iframe"===t.dataType.substr(0,6)&&t.context.find(".progress").addClass(!l.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),i._trigger("sent",e,t)},done:function(i,n){if(i.isDefaultPrevented())return!1;var r,o,a=l(this).data("blueimp-fileupload")||l(this).data("fileupload"),s=(n.getFilesFromResponse||a.options.getFilesFromResponse)(n);n.context?n.context.each(function(e){var t=s[e]||{error:"Empty file upload result"};o=a._addFinishedDeferreds(),a._transition(l(this)).done(function(){var e=l(this);r=a._renderDownload([t]).replaceAll(e),a._forceReflow(r),a._transition(r).done(function(){n.context=l(this),a._trigger("completed",i,n),a._trigger("finished",i,n),o.resolve()})})}):(r=a._renderDownload(s)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer),a._forceReflow(r),o=a._addFinishedDeferreds(),a._transition(r).done(function(){n.context=l(this),a._trigger("completed",i,n),a._trigger("finished",i,n),o.resolve()}))},fail:function(i,n){if(i.isDefaultPrevented())return!1;var r,o,a=l(this).data("blueimp-fileupload")||l(this).data("fileupload");n.context?n.context.each(function(e){if("abort"!==n.errorThrown){var t=n.files[e];t.error=t.error||n.errorThrown||n.i18n("unknownError"),o=a._addFinishedDeferreds(),a._transition(l(this)).done(function(){var e=l(this);r=a._renderDownload([t]).replaceAll(e),a._forceReflow(r),a._transition(r).done(function(){n.context=l(this),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()})})}else o=a._addFinishedDeferreds(),a._transition(l(this)).done(function(){l(this).remove(),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()})}):"abort"!==n.errorThrown?(n.context=a._renderUpload(n.files)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer).data("data",n),a._forceReflow(n.context),o=a._addFinishedDeferreds(),a._transition(n.context).done(function(){n.context=l(this),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()})):(a._trigger("failed",i,n),a._trigger("finished",i,n),a._addFinishedDeferreds().resolve())},progress:function(e,t){if(e.isDefaultPrevented())return!1;var i=Math.floor(t.loaded/t.total*100);t.context&&t.context.each(function(){l(this).find(".progress").attr("aria-valuenow",i).children().first().css("width",i+"%")})},progressall:function(e,t){if(e.isDefaultPrevented())return!1;var i=l(this),n=Math.floor(t.loaded/t.total*100),r=i.find(".fileupload-progress"),o=r.find(".progress-extended");o.length&&o.html((i.data("blueimp-fileupload")||i.data("fileupload"))._renderExtendedProgress(t)),r.find(".progress").attr("aria-valuenow",n).children().first().css("width",n+"%")},start:function(e){if(e.isDefaultPrevented())return!1;var t=l(this).data("blueimp-fileupload")||l(this).data("fileupload");t._resetFinishedDeferreds(),t._transition(l(this).find(".fileupload-progress")).done(function(){t._trigger("started",e)})},stop:function(e){if(e.isDefaultPrevented())return!1;var t=l(this).data("blueimp-fileupload")||l(this).data("fileupload"),i=t._addFinishedDeferreds();l.when.apply(l,t._getFinishedDeferreds()).done(function(){t._trigger("stopped",e)}),t._transition(l(this).find(".fileupload-progress")).done(function(){l(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),l(this).find(".progress-extended").html("&nbsp;"),i.resolve()})},processstart:function(e){if(e.isDefaultPrevented())return!1;l(this).addClass("fileupload-processing")},processstop:function(e){if(e.isDefaultPrevented())return!1;l(this).removeClass("fileupload-processing")},destroy:function(e,t){if(e.isDefaultPrevented())return!1;var i=l(this).data("blueimp-fileupload")||l(this).data("fileupload"),n=function(){i._transition(t.context).done(function(){l(this).remove(),i._trigger("destroyed",e,t)})};t.url?(t.dataType=t.dataType||i.options.dataType,l.ajax(t).done(n).fail(function(){i._trigger("destroyfailed",e,t)})):n()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(e){return e||(e=l.Deferred()),this._finishedUploads.push(e),e},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var e=l(this),t=e.prop("href"),i=e.prop("download"),n="application/octet-stream";e.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[n,i,t].join(":"))}catch(e){}})},_formatFileSize:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" GB":1e6<=e?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" Gbit/s":1e6<=e?(e/1e6).toFixed(2)+" Mbit/s":1e3<=e?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),i=Math.floor(e/86400);return(i=i?i+"d ":"")+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(e,t){if(!e)return l();var i=e({files:t,formatFileSize:this._formatFileSize,options:this.options});return i instanceof l?i:l(this.options.templatesContainer).html(i).children()},_renderPreviews:function(i){i.context.find(".preview").each(function(e,t){l(t).append(i.files[e].preview)})},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(e){e.preventDefault();var t=l(e.currentTarget),i=t.closest(".template-upload").data("data");t.prop("disabled",!0),i&&i.submit&&i.submit()},_cancelHandler:function(e){e.preventDefault();var t=l(e.currentTarget).closest(".template-upload,.template-download"),i=t.data("data")||{};i.context=i.context||t,i.abort?i.abort():(i.errorThrown="abort",this._trigger("fail",e,i))},_deleteHandler:function(e){e.preventDefault();var t=l(e.currentTarget);this._trigger("destroy",e,l.extend({context:t.closest(".template-download"),type:"DELETE"},t.data()))},_forceReflow:function(e){return l.support.transition&&e.length&&e[0].offsetWidth},_transition:function(t){var i=l.Deferred();return l.support.transition&&t.hasClass("fade")&&t.is(":visible")?t.bind(l.support.transition.end,function(e){e.target===t[0]&&(t.unbind(l.support.transition.end),i.resolveWith(t))}).toggleClass("in"):(t.toggleClass("in"),i.resolveWith(t)),i},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer;this._on(t.find(".start"),{click:function(e){e.preventDefault(),i.find(".start").click()}}),this._on(t.find(".cancel"),{click:function(e){e.preventDefault(),i.find(".cancel").click()}}),this._on(t.find(".delete"),{click:function(e){e.preventDefault(),i.find(".toggle:checked").closest(".template-download").find(".delete").click(),t.find(".toggle").prop("checked",!1)}}),this._on(t.find(".toggle"),{change:function(e){i.find(".toggle").prop("checked",l(e.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),t&&(e.uploadTemplateId&&(e.uploadTemplate=t(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=t(e.downloadTemplateId)))},_initFilesContainer:function(){var e=this.options;void 0===e.filesContainer?e.filesContainer=this.element.find(".files"):e.filesContainer instanceof l||(e.filesContainer=l(e.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),l.support.fileInput||this._disableFileInputButton()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})});